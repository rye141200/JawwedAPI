<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Google Sign-In Test</title>
    <script src="https://accounts.google.com/gsi/client" async></script>
  </head>
  <body>
    <h1>Google Sign-In Test</h1>

    <!-- Updated Google Sign-In button with prompt=login parameter -->
    <div
      id="g_id_onload"
      data-client_id="17494011183-fmimqr7mgrrfubd6vsmdbd7vuejsae2l.apps.googleusercontent.com"
      data-callback="handleCredentialResponse"
      data-prompt_parent_id="g_id_onload"
      data-auto_prompt="false"
      data-prompt="login"
      <!--
      This
      forces
      a
      new
      login
      every
      time
      --
    ></div>

    <div
      class="g_id_signin"
      data-type="standard"
      data-size="large"
      data-theme="outline"
      data-text="sign_in_with"
      data-shape="rectangular"
      data-logo_alignment="left"
    ></div>

    <pre
      id="token-display"
      style="
        margin-top: 20px;
        padding: 10px;
        background-color: #f5f5f5;
        word-wrap: break-word;
      "
    ></pre>
    <button
      id="copy-button"
      style="display: none; margin-top: 10px"
      onclick="copyToken()"
    >
      Copy Token
    </button>
    <button id="logout-button" style="margin-top: 10px" onclick="signOut()">
      Sign Out
    </button>

    <script>
      function handleCredentialResponse(response) {
        // Display the ID token
        document.getElementById("token-display").textContent =
          response.credential;
        document.getElementById("copy-button").style.display = "block";
        console.log("ID Token: ", response.credential);

        // Store token info for verification
        const tokenParts = response.credential.split(".");
        if (tokenParts.length >= 2) {
          const payload = JSON.parse(atob(tokenParts[1]));
          console.log(
            "Token expires at: ",
            new Date(payload.exp * 1000).toLocaleString()
          );
          console.log(
            "Token issued at: ",
            new Date(payload.iat * 1000).toLocaleString()
          );
        }
      }

      function copyToken() {
        const tokenText = document.getElementById("token-display").textContent;
        navigator.clipboard
          .writeText(tokenText)
          .then(() => alert("Token copied to clipboard"))
          .catch((err) => console.error("Failed to copy: ", err));
      }

      function signOut() {
        // Clear any Google auth state
        google.accounts.id.disableAutoSelect();

        // Clear token display
        document.getElementById("token-display").textContent = "";
        document.getElementById("copy-button").style.display = "none";

        // Clear cookies for Google domains
        document.cookie.split(";").forEach(function (c) {
          if (c.trim().startsWith("g_")) {
            document.cookie = c
              .replace(/^ +/, "")
              .replace(
                /=.*/,
                "=;expires=" + new Date().toUTCString() + ";path=/"
              );
          }
        });

        alert("Signed out. You can now get a new token.");

        // Reload the page to ensure a clean state
        setTimeout(() => {
          window.location.reload();
        }, 1000);
      }
    </script>
  </body>
</html>
